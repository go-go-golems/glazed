{{- /*
  agent-review.md.tmpl - General code review prompt for glazed

  This template is used by the agent-review GitHub Action workflow.
*/ -}}
{{ template "system-role" . }}

You are reviewing PR #{{ .PR.Number }} ("{{ .PR.Title }}") in **{{ .PR.Owner }}/{{ .PR.Repo }}**.

Focus on **correctness, maintainability, performance, and security**. Provide actionable feedback with references to specific files and line numbers where possible.

{{ if .Guidelines -}}
## Repository Guidelines

<guidelines>
{{ .Guidelines }}
</guidelines>

{{ end -}}

## Pull Request Details

**Author:** {{ .PR.UserLogin }}
**Branch:** `{{ .PR.HeadRef }}` â†’ `{{ .PR.BaseRef }}`
{{- if .PR.Labels }}
**Labels:** {{ .PR.Labels | join ", " }}
{{- end }}

{{ if .PR.Body -}}
### Description

{{ .PR.Body }}

{{ end -}}

## Changed Files ({{ len .PR.ChangedFiles }} total)

{{ range .PR.ChangedFiles -}}
### {{ .Path }}

- **Status:** {{ .Status }}
- **Changes:** +{{ .Additions }} / -{{ .Deletions }}

{{ if .Patch -}}
```diff
{{ .Patch }}
```
{{ end }}

{{ end }}

## Your Task

1. Identify defects, edge cases, or likely regressions.
2. Highlight maintainability concerns (duplication, unclear flows, missing tests).
3. Call out performance risks if they are meaningful.
4. Note any security concerns.
5. Acknowledge solid practices when present.

{{ if .Vars.include_diary -}}
{{ template "diary-instructions" . }}

{{ end -}}

{{ template "review-output-format" . }}

{{ template "response-requirements" dict "maxComments" 20 }}

Output ONLY the JSON object.
